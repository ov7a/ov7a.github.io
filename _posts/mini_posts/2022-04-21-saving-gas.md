---
layout: post
title: Экономьте газ
tags: [algorithms, blockchain, мысли]
tg_id: 290
---
В мире "современной" разработки, где бизнесу часто нужно чтобы "лишь бы работало", компиляторы "сами все оптимизируют", а проблемы с производительностью решаются методом "ну накинь там пока ресурсов на под", оптимизация алгоритмов сверх банального "для поиска используй хэш-таблицу" кажется излишней, потому что "и так сойдет".

Однако есть ниша, в которой экономить элементарные операции все еще актуально — смарт-контракты. Каждое вычисление чего-то стоит. Например, в Etherium каждая операция смарт-контракта тратит немного "газа", не уложился в лимит — транзакция откатывается. В периоды большой нагрузки на сеть газ стоит дороже, в периоды низкой, соответственно, дешевле. Если алгоритм оптимизирован, то на его выполнение будет потрачено меньше газа и, как следствие, меньше криптовалюты.

Хотя [некоторые паттерны](https://arxiv.org/pdf/1703.03994.pdf) неоптимального кода довольно тривиально обнаруживаются и исправляются, и вызваны скорее незрелостью технологии (например, расчет суммы, которая не зависит от внешних параметров, может быть заменен формулой). Есть [несколько инструментов](https://ethereum.org/en/developers/docs/gas/#strategies-for-you-to-reduce-gas-costs) для оценки использования газа, а еще можно покрыть контракт тестами (например, с помощью [hardhat](https://hardhat.org/) или [brownie](https://eth-brownie.readthedocs.io/en/stable/)) и выводить либо оценку, либо точное значение потраченного газа. Но чтобы оптимизировать — тут головой еще надо думать, увы.

Я немного поигрался с двумя последними инструментами, сделал пару тестовых контрактов и посмотрел на использование газа, в целом занятно. Думал даже как-нибудь поиздеваться над студентами, чтобы они оптимизировали в лабах использование элементарных операций, но экосистема nodejs в обоих случаях не очень к этому располагает. Хоть свою RAM-машину пиши...

