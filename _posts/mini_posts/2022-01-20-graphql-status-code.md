---
layout: post
title: Статус-код ответа graphql
tags: [graphql, api, http]
tg_id: 264
---
Если почитать рандомные статьи ([раз](https://medium.com/impraise-design-engineering/making-mistakes-with-graphql-874b8ca62b9d), [два](https://stackoverflow.com/questions/59729656/http-status-code-handling-in-graphql-apis)) про работу с GraphQL, то получается, что обработка ошибок как в REST  — это "неправильный" подход к использованию GraphQL. Потому что, во-первых, GraphQL не привязан к транспортному протоколу, а во-вторых, спецификация явно определяет, что для ошибок есть специальное поле. Кроме того, один запрос может содержать несколько подзапросов, и не понятно, что делать, если один обработался успешно (как вариант, предлагают 207), а другой — нет. И вроде как надо возвращать 200, если запрос выполнился успешно, и 500 — в любом другом случае.

Однако, когда тебе на невалидный запрос возвращается 200 с пустыми данными, это выглядит, как минимум, странно. Если копнуть глубже, то выяснится, что в [официальной документации](https://graphql.org/learn/serving-over-http/) про статус-код не говорится ничего. В 2018 в рабочей группе GraphQL [поднимался](https://github.com/graphql/graphql-wg/blob/d3756c40e4f19931a680edd688b4b74feb146b0b/notes/2018-02-01.md) этот вопрос, и потом еще в [2019](https://github.com/graphql/graphql-wg/blob/389d6c4eef16a949fae6daa4f88973a85f36e20f/notes/2019-11-07.md) и [2020](https://github.com/graphql/graphql-wg/blob/389d6c4eef16a949fae6daa4f88973a85f36e20f/notes/2020-04-02.md). Но четкого результата у этих обсуждений нет, только [черновик](https://github.com/graphql/graphql-over-http/blob/main/spec/GraphQLOverHTTP.md).

Я в итоге на текущем проекте решил группировать по убыванию. Если нет ошибок — 200, хотя бы один 5xx код — это 500, несколько 4xx = 400, один 4xx — его и вернуть, в любой непонятной ситуации — 500.

