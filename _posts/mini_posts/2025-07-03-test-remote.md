---
layout: post
title: Не тестируйте внешние домены
tags: [bestpractices, testing, net, иб]
tg_id: 631
---
Не раз такое видел, что в тесте по интеграции с внешним API идет обращение к реальному домену. Некоторые даже при этом говорят "ачетаково".

Основных проблем две: нестабильность теста и безопасность.

С нестабильностью понятно — сервис прилег, проблемы по дороге с сетью/DNS, rate-limiter зарубил вашего разраба, который запускал тесты 100500 раз в секунду, и привет, тест завален (очень сомневаюсь, что там учитываются подобные проблемы). Да, изредка нужно протестировать интеграцию 1-в-1, но это имеет смысл в весьма редких случаях и может быть достигнуто другими средствами (ну и graceful degradation никто не отменял). Опять же, как вы с реальным сервисом будете тестировать обработку всех проблем?

С безопасностью посложнее — между вами и доменом сервиса есть несколько промежуточных узлов, и вряд ли вы проверяете всю цепочку... Ок, домен доверенный, снимаем шапочку из фольги. А если у вас в коде `randomserver.org`? Конечно, вероятность, что об этом кто-то узнает, довольно мала. Внимательный читатель может догадаться, почему эта вероятность может резко повыситься:) Но если прям очень надо потестировать что-то связанное с реальной сетью (что еще более невероятно), то хотя бы используйте [домены из RFC](https://www.rfc-editor.org/rfc/rfc2606.html#page-2): `.test`, `.example`, `.invalid`.

Хотя о чем это я, простите, в половине инструкций в интернете сейчас `curl | sh`.
