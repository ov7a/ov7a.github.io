---
layout: post
title: Запуск графического приложения с админскими правами
tags: [linux]
---
Раньше для этого можно было вызвать команду с `gksu`, например `gksu kse`. Однако, [gksu убрали из дистрибутивов](https://itsfoss.com/gksu-replacement-ubuntu/), т.к. он не безопасен.

Альтернатива — использовать политики (для параноиков) или `pkexec`. Но есть проблемка: при подтверждении запуска виден [только исполняемый файл](https://askubuntu.com/questions/1350372/how-to-force-policy-kit-agent-to-show-full-information-about-command-line-argume), но не его аргументы. Т.е. окно авторизации для `pkexec sh -c 'echo hello'` и для `pkexec sh -c 'rm -rf /'` будет выглядеть одинаково. Решить это можно через политики, но писать душный xml — скучно, поэтому можно извратиться [по-другому](https://askubuntu.com/a/1350485).

Можно отредактировать сообщение сервиса `polkit`, вставив туда шаблон `$(command_line)`. Для этого:
1. Берем файл с переводом для британского языка и распаковываем его
`msgunfmt /usr/share/locale-langpack/en_GB/LC_MESSAGES/polkit-1.mo -o polkit-1.po`
2. Редактируем `polkit-1.po` любым текстовым редактором, добавляя в `msgstr` `Authentication is needed to run '$(program)' ('$(command_line)')`, `msgid` не трогаем.
3. Пакуем отредактированный файл обратно, в директорию со своей локалью (у меня это en_US)
`msgfmt polkit-1.po -o /usr/share/locale/en_US/LC_MESSAGES/polkit-1.mo`
4. Рестартуем сервис polkit, чтобы изменения применились: `systemctl restart polkit`

После этого можно будет увидеть полную команду, которую кто-то хочет выполнить с правами супер-пользователя. Ибо нечего авторизовывать что попало, а то какой-нибудь дропбокс любит запрашивать таким макаром право на запуск баш-скрипта, который меняет владельца и права на свои папки.

