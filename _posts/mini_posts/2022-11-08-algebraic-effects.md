---
layout: post
title: Проблемы монад и алгебраические эффекты
tags: [фп]
---
В продолжение про [проверяемые исключения в Scala](/2021/10/28/scala-checked-exceptions.html) — очень доступный [доклад](https://youtu.be/nGhoZzihbHY?t=1560) про проблемы монад и способы их решения. Первые 26 минут можно посмотреть, если хотите освежить в памяти, что такое монада, и как она проникла в ваш любимый язык, докладчик рассказывает на простейшем примере. Но кто уже знаком с этой идеей, может смело мотать на середину.

Первая и основная на мой взгляд проблема, с которой сталкиваешься при композиции нескольких Either/Result'ов — общий тип для ошибок. Кстати, это одна из проблем, на которую я мужественно забил во время своих [забав с elm](/2022/03/07/profunctor-rating-elm.html#section-19). Кроме этого, функции приобретают [цвета](http://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/), а с типами вроде `Either[Either[ClientError, ServerError], Response]` легко запутаться.

Одно из решений — Monad Transformers в Haskell, которые позволяют запихать одну монаду внутрь другой. Однако это довольно трудное для восприятия решение ([судите сами](https://ru.wikibooks.org/wiki/Haskell/Monad_transformers)) и типы все равно выглядят страшно.

Альтернативное решение — алгебраические эффекты. "Алгебраические" — потому что образуют алгебру, т.е. если функция `f` имеет эффект `A`, а функция `g` имеет эффект `B`, то любая их композиция будет иметь эффект `C = A + B = B + A`, причем `А + 0 = A`, где `0` — отсутствие эффекта. Алгебраические эффекты аналогичны по свойствам трансформерам, но должны быть проще для восприятия. И вариант их реализации, который описывает докладчик, практически идентичен тому, что [предлагал Одерски](/2021/10/28/scala-checked-exceptions.html) больше года назад с проверяемыми исключениями (aka Capabilities). 

В конце еще интересная мысль про то, что можно обрабатывать исключения и потом иметь возможность возвращаться к проблемному месту, но реализация этого явно дорога, а что она полезного даст — непонятно.

