---
layout: post
title: Мои впечатления от Svelte
tags: [svelte, javascript, typescript, web, frontend]
---
Решил попробовать, "каково это там на фронте" и выбрал [Svelte](https://svelte.dev), как самый любимый разработчиками веб-фреймворк по результатам [опроса StackOverflow](https://insights.stackoverflow.com/survey/2021#section-most-loved-dreaded-and-wanted-web-frameworks) (к которому стоит относиться с опаской, потому что на втором месте ASP.NET Core, а на седьмом — Spring). Ключевая фишка — отсутствие виртуального DOM. Я вообще сначала думал, что он будет чуть ли не SSR и компиляция, но в процессе изучения понял, что ошибался.

В качестве пет-проекта [сделал небольшую страничку](/kesha/), где можно визуально сравнить свое произношение английских слов с эталонным. Заодно немного изучил [работу с микрофоном через браузер](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API/Recording_a_media_element). Код можно посмотреть [тут](https://github.com/ov7a/kesha).

Основа интерактивности компонентов — во взаимодействии через привязку к переменным. Привязка может быть односторонней, а может быть двухсторонней. Двухсторонняя может быть только в случае, если свойство элемента может быть изменено пользователем — это не очень очевидно и немного не универсально: если компонент написан на чистом JavaScript, то привязаться к нему надо будет через события или через промежуточный слой. А еще не будет работать привязка на изменяемое свойство контролируемой переменной, потому что обновление вызывается при присваивании самой переменной. Условной привязки [нет](https://github.com/sveltejs/svelte/issues/4570), поэтому чтобы заставить по галочке двигаться два ползунка одновременно, а при ее снятии — независимо, мне пришлось накостылить решение через [Store](https://svelte.dev/docs#Store_contract), который обычно используется для сложных взаимодействий по PubSub модели. Можно было сделать через [события](https://svelte.dev/tutorial/component-events), но получилось бы не сильно лучше, имхо.

Синтаксис шаблонирования в HTML выглядит довольно простым, жаль только, что в условиях обычный JavaScript, а не TypeScript. Впрочем, ничего сложного я с ним и не делал, в Jekyll'овском шаблонизаторе на грабли тоже [не сразу](/2020/04/06/github-pages.html) наступил.

Не очень очевидным оказался процесс инициализации, потому что некоторые вещи надо вызывать через [onMount](https://svelte.dev/docs#onMount), после привязки к DOM, а некоторые, например, [код в "статическом" блоке](https://svelte.dev/docs#script_context_module) — сразу.

С SSR ждало разочарование — из коробки его нет, настраивать не очень понятно как, одобренный способ [еще не устаканился](https://svelte.dev/blog/whats-the-deal-with-sveltekit). "Compile-centric" тоже не ощутил: да, все зависимости в dev, но почти все ошибки все равно ловить через отладку в браузере.

По дороге меня еще ждали типичные проблемы с CORS, которые я обошел использованием [allOrigins](https://allorigins.win/), сложности CSS (я по-прежнему [офигеваю](/2020/05/03/css-impressions.html), как там тяжело сделать "простые" вещи, например, вертикальное выравнивание текста по середине). Немного споткнулся и о TypeScript — работа с undefined оставляет желать лучшего, импорт типа ведет себя не очень очевидно, но тут я скорее не все понял.

Отдельной болью была отладка и адаптация под планшет. Вляпался в [отличия обработки нажатий мышкой и пальцем](https://developer.mozilla.org/en-US/docs/Web/API/Touch_events/Supporting_both_TouchEvent_and_MouseEvent), неработающую запись без https, отсутствие поддержки MediaRecorder (пришлось использовать [полифилл](https://github.com/ai/audio-recorder-polyfill), который поддерживает API не полностью). Изюминкой было то, что если не сработала привязка в элементе, то браузер показывал просто пустой экран — и попробуй догадайся, что ему не понравилось — на планшете нет консоли разработчика, подключать ее геморройно. А проблема была в том, что не поддерживался оператор [?.](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining).

В целом впечатления остались скорее приятные. От Svelte у меня почти не горело :). Идея инкапсулировать компонент в одном файле и потом использовать как HMTL-тег на мой взгляд довольно прикольная. Выглядит похоже на Vue (как он мне смутно запомнился по мимолетному знакомству).

P.S. Не знаю, зачем я продолжаю заниматься этим мазохизмом с фронтендом :) Но возможность показать что-то доступное для интерактива немного греет.

