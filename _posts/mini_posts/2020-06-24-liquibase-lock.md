---
layout: post
title: Лок в liquibase
tags: [бд]
---
У liquibase есть неприятный [баг](https://liquibase.jira.com/browse/CORE-2375): иногда при рестарте приложения оно может просто ничего не делать.
Происходит это из-за того, что liquibase при применении своих изменений выставляет лок.
И если приложение падает во время этого процесса, то этот лок никто не снимет, и перезапущенное приложение будет ждать его освобождения вечно.
Эдакий deadlock с самим собой.

Решается симптом проблемы очень просто — удалением лока:
```
UPDATE DATABASECHANGELOGLOCK SET LOCKED=FALSE, LOCKGRANTED=null, LOCKEDBY=null where ID=1;
```
Мораль сей басни очевидна: вечные локи до добра не доводят.

P.S. "Обожаю" мажорные баги, которые могут не править больше 5 лет (а судя по [SO](https://stackoverflow.com/questions/15528795/liquibase-lock-reasons), существует этот баг уже лет 7 минимум).

