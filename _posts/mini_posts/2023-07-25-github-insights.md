---
layout: post
title: Статистика меток тикетов GitHub
tags: [kotlin, github, frontend, javascript, мысли]
---
Вернулся недавно к своему пет-проекту по вычислению [статистики времени принятия пулл-реквестов](/github_insights), который я сделал на Kotlin/JS [пару лет назад](/2021/10/06/kotlin-js.html). Добавил туда построение графа, где вершинами являются метки, а ребро говорит о том, что есть тикет, в котором есть обе метки.

К сожалению, взаимодействие с JS не стало лучше. Возможно частично из-за того, что рекомендуемый подход — [использовать multiplatform](https://kotlinlang.org/docs/js-overview.html). Планирую как-нибудь попробовать. 

Из неприятного — в последней версии Kotlin [сломали генерацию интерфейсов](https://youtrack.jetbrains.com/issue/KT-54445) из типов `.d.ts`, потому что [требуется](https://youtrack.jetbrains.com/issue/KT-54395) `npm install`. Не стал разбираться детально с причинами, просто ругнулся из-за унылого решения и понизил версию платформы. Еще словил баг инкрементального компилятора, который вместо человеческой ошибки (я забыл передать требуемый аргумент) выдал мне хрень, но заводить баг посчитал излишним, т.к. скоро будет K2.

В основном делал кучу всякого рефакторинга, чтобы было получше. Опять поругался с библиотекой сериализации, с которой нужно много танцевать, если хочется иметь нормальный полиморфизм. Несколько раз возникала мысль, что когда пытаешься срезать углы, чтобы написать "быстрее", это приводит к большим проблемам и трудозатратам, чем если писать сразу "правильно", хоть это и утомительно. Возможно, опять перфекционизм заиграл в одном месте.

Немного интересного узнал с точки зрения фронта — как [скопировать в буфер обмена](https://developer.mozilla.org/en-US/docs/Web/API/Navigator/clipboard), как [сделать ссылку на скачивание файла](https://github.com/ov7a/github-insights/blob/d388ae56029febc3eff5b176d5e6a77a3d60c13a/src/main/kotlin/ru/ov7a/github/insights/ui/presentation/LabelsPresenter.kt#L119) "из памяти" и как сделать [вкладки на CSS](/2023/07/20/css-tabs.html) (которые не пригодились в итоге).

Думал еще сделать какую-нибудь визуализацию графа с автоматической укладкой, но всякие force-layout мне не понравились. На парочке интересующих меня репозиториев все выглядело просто как комок вершин без выраженной структуры. Попробовал [force-graph](https://github.com/vasturiano/force-graph) (быстро, просто, негибко), [d3](https://d3js.org/) (быстро, очень гибко, хрен настроишь) и [vivagraph](https://github.com/anvaka/VivaGraphJS) (вроде работает, но куча сломанных ссылок на доки напрягла). [Cytoscape](https://js.cytoscape.org/) не стал пробовать, воспоминаний с работы было достаточно, чтобы сделать это неинтересным. В итоге решил сделать просто экспорт в [.dot](https://graphviz.org/doc/info/lang.html) — если кто вдруг будет пользоваться (кек), сам разберется.

В целом как пет-проект мне эта фигня нравится. Делает что-то не совсем бесполезное, можно потрогать фронт, котлиновские корутины, GraphQL и всякую мелочевку попутно.
